{% extends "base.html" %}
{% block title %}KralZeka AsistanÄ±{% endblock %}
{% block content %}
<div class="container-fluid mt-3">
  <div class="row">
    <!-- Sol MenÃ¼ -->
    <div class="col-md-3">
      <div class="card shadow-sm p-3">
        <h4 class="mb-3 text-center">âš™ï¸ Modlar</h4>
        <ul class="list-group">
          <li class="list-group-item"><a href="/chat?mode=sohbet">ğŸ’¬ Sohbet Modu</a></li>
          <li class="list-group-item"><a href="/chat?mode=sunum">ğŸ–¼ï¸ Sunum Modu</a></li>
          <li class="list-group-item"><a href="/chat?mode=gorsel">ğŸ¨ GÃ¶rsel OluÅŸturma</a></li>
          <li class="list-group-item"><a href="/chat?mode=kalite">ğŸ“ˆ GÃ¶rsel Kalite YÃ¼kseltme</a></li>
          {% if current_user.is_admin %}
          <li class="list-group-item"><a href="/chat?mode=kod">ğŸ’» Kod Yazma (YalnÄ±zca Admin)</a></li>
          <li class="list-group-item"><a href="/chat?mode=ogretim">ğŸ“˜ YazÄ±lÄ±m Ã–ÄŸretme</a></li>
          {% endif %}
        </ul>

        <div class="mt-4">
          <form method="POST" action="/upload_image" enctype="multipart/form-data">
            <label class="form-label">ğŸ“¸ GÃ¶rsel YÃ¼kle</label>
            <input type="file" name="image" class="form-control mb-2" accept="image/*" required>
            <button class="btn btn-sm btn-primary w-100" type="submit">YÃ¼kle</button>
          </form>
        </div>

        {% if current_user.is_admin %}
        <div class="mt-4">
          <a href="/admin_panel" class="btn btn-warning w-100">ğŸ‘‘ YÃ¶netici Paneli</a>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Sohbet AlanÄ± -->
    <div class="col-md-9">
      <div class="card shadow-sm p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4>ğŸ§  {{ mode|capitalize }} Modu</h4>
          <form action="/logout" method="post">
            <button class="btn btn-danger btn-sm">Ã‡Ä±kÄ±ÅŸ Yap</button>
          </form>
        </div>

        <!-- Sohbet GeÃ§miÅŸi -->
        <div id="chat-box" class="border p-3 mb-3" style="height: 400px; overflow-y: auto;">
          {% for msg in messages %}
          <div class="mb-2">
            {% if msg.sender == 'user' %}
              <div class="text-end"><span class="badge bg-primary">Sen:</span> {{ msg.text }}</div>
            {% else %}
              <div><span class="badge bg-secondary">KralZeka:</span> {{ msg.text|safe }}</div>
            {% endif %}
          </div>
          {% endfor %}
        </div>

        <!-- Mesaj GÃ¶nderme AlanÄ± -->
        <form method="POST" action="/send_message" class="d-flex">
          <input type="hidden" name="mode" value="{{ mode }}">
          <input type="text" name="message" class="form-control me-2" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..." required>
          <button class="btn btn-success">GÃ¶nder</button>
        </form>

        {% if mode == "gorsel" %}
        <small class="text-muted mt-2 d-block">ğŸ¨ GÃ¶rsel oluÅŸturmak iÃ§in kÄ±sa aÃ§Ä±klama girin. (Ã–rnek: â€œUzayda yÃ¼rÃ¼yen kediâ€)</small>
        {% elif mode == "kalite" %}
        <small class="text-muted mt-2 d-block">ğŸ“ˆ GÃ¶rsel kalitesini artÄ±rmak iÃ§in yÃ¼klediÄŸiniz gÃ¶rseli seÃ§in.</small>
        {% elif mode == "kod" and current_user.is_admin %}
        <small class="text-muted mt-2 d-block">ğŸ’» Kod yazma modunda, Ã¶nce yapmak istediÄŸin projeyi anlat; KralZeka detay soracak.</small>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
  // Otomatik chat kaydÄ±rma
  const chatBox = document.getElementById('chat-box');
  if (chatBox) chatBox.scrollTop = chatBox.scrollHeight;
</script>
{% endblock %}
